<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <title>{% block title %}{{ app_name }}{% endblock %}</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="{{ url_for('static', filename='layui-v2.13.2/layui/css/layui.css') }}">
    {% block styles %}{% endblock %}
    <style>
        .layui-body { bottom: 0; }
    </style>
</head>
<body class="layui-layout-body">
    <div class="layui-layout layui-layout-admin">
        <div class="layui-header">
            <div class="layui-logo">
                {% if logo_url %}
                <img src="{{ logo_url }}" style="height: 30px; margin-right: 10px;">
                {% endif %}
                {{ app_name }}
            </div>
            
            <ul class="layui-nav layui-layout-right">
                {% if current_user.is_authenticated %}
                    <li class="layui-nav-item">
                        <a href="javascript:;">
                            {{ current_user.username }}
                        </a>
                        <dl class="layui-nav-child">
                            <dd><a href="{{ url_for('auth.logout') }}">退出登录</a></dd>
                        </dl>
                    </li>
                {% else %}
                    <li class="layui-nav-item"><a href="{{ url_for('auth.login') }}">登录</a></li>
                {% endif %}
            </ul>
        </div>
        
        {% if current_user.is_authenticated %}
        <div class="layui-side layui-bg-black">
            <div class="layui-side-scroll">
                <ul class="layui-nav layui-nav-tree" lay-filter="test">
                    <li class="layui-nav-item {{ 'layui-nav-itemed' if request.endpoint == 'dashboard.index' else '' }}">
                        <a href="{{ url_for('dashboard.index') }}">仪表盘</a>
                    </li>
                    
                    <li class="layui-nav-item {{ 'layui-nav-itemed' if 'business' in request.endpoint else '' }}">
                        <a href="javascript:;">业务管理</a>
                        <dl class="layui-nav-child">
                            <dd class="{{ 'layui-this' if request.endpoint == 'business.list_customers' else '' }}">
                                <a href="{{ url_for('business.list_customers') }}">客户管理</a>
                            </dd>
                            <dd class="{{ 'layui-this' if request.endpoint == 'business.analysis' else '' }}">
                                <a href="{{ url_for('business.analysis') }}">舆情分析</a>
                            </dd>
                            <dd class="{{ 'layui-this' if request.endpoint == 'business.warehouse' else '' }}">
                                <a href="{{ url_for('business.warehouse') }}">数据仓库管理</a>
                            </dd>
                            <dd class="{{ 'layui-this' if request.endpoint == 'business.rules' else '' }}">
                                <a href="{{ url_for('business.rules') }}">采集规则库</a>
                            </dd>
                            <!-- Add more business links here -->
                        </dl>
                    </li>
                    
                    {% if current_user.role.name == 'Admin' %}
                    <li class="layui-nav-item {{ 'layui-nav-itemed' if 'admin' in request.endpoint else '' }}">
                        <a href="javascript:;">系统管理</a>
                        <dl class="layui-nav-child">
                            <dd class="{{ 'layui-this' if request.endpoint == 'admin.user_list' else '' }}">
                                <a href="{{ url_for('admin.user_list') }}">用户管理</a>
                            </dd>
                            <dd class="{{ 'layui-this' if request.endpoint == 'admin.settings' else '' }}">
                                <a href="{{ url_for('admin.settings') }}">系统设置</a>
                            </dd>
                        </dl>
                    </li>
                    {% endif %}
                </ul>
            </div>
        </div>
        {% endif %}
        
        <div class="layui-body" style="{{ 'left: 0;' if not current_user.is_authenticated else '' }}">
            <div style="padding: 15px;">
                {% with messages = get_flashed_messages(with_categories=true) %}
                  {% if messages %}
                    {% for category, message in messages %}
                      <div class="layui-elem-quote layui-quote-nm" style="border-left: 5px solid {{ '#FF5722' if category == 'error' else '#009688' }};">
                        {{ message }}
                      </div>
                    {% endfor %}
                  {% endif %}
                {% endwith %}

                {% block content %}{% endblock %}
            </div>
        </div>
        
        <div class="layui-footer" style="{{ 'left: 0;' if not current_user.is_authenticated else '' }}">
            <!-- 底部固定区域 -->
            © {{ app_name }}
        </div>
    </div>
    <script src="{{ url_for('static', filename='layui-v2.13.2/layui/layui.js') }}"></script>
    <script>
    //JavaScript代码区域
    layui.use('element', function(){
      var element = layui.element;
    });
    </script>
    {% block scripts %}{% endblock %}
</body>
</html>
